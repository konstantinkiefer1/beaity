"use strict";(()=>{var e={};e.id=403,e.ids=[403],e.modules={38013:e=>{e.exports=require("mongodb")},11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},17666:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>_,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>v});var s={};t.r(s),t.d(s,{POST:()=>d});var o=t(95419),n=t(69108),a=t(99678),i=t(98984),c=t(49605),p=t(74417),u=t(22361),l=t(24081),m=t(87786);async function d(e){let r=await (0,c.getServerSession)(p.L);if(!r)return i.NextResponse.json({error:"Not signed in"},{status:401});try{await (0,u.Z)();let t=await e.json(),{id:s}=r.user,o=await m.Z.findById(s);if(!o?.customerId)return i.NextResponse.json({error:"You don't have a billing account yet. Make a purchase first."},{status:400});if(!t.returnUrl)return i.NextResponse.json({error:"Return URL is required"},{status:400});let n=await (0,l.xL)({customerId:o.customerId,returnUrl:t.returnUrl});return i.NextResponse.json({url:n})}catch(e){return console.error(e),i.NextResponse.json({error:e?.message},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/stripe/create-portal/route",pathname:"/api/stripe/create-portal",filename:"route",bundlePath:"app/api/stripe/create-portal/route"},resolvedPagePath:"C:\\Coding\\test\\app\\api\\stripe\\create-portal\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:_,headerHooks:f,staticGenerationBailout:v}=g,y="/api/stripe/create-portal/route";function S(){return(0,a.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:x})}},35484:(e,r,t)=>{t.d(r,{Z:()=>o});var s=t(44196);let o={appName:"Beautylicious",appDescription:"Brow- und Wimpernlifting in Saarbr\xfccken. Erwecke deine nat\xfcrliche Sch\xf6nheit!",domainName:"pay.hellohanf.de",crisp:{id:"",onlyShowOnRoutes:["/"]},stripe:{plans:[{priceId:"price_456",name:"Starter",description:"Perfect for small projects",price:79,priceAnchor:99,features:[{name:"NextJS boilerplate"},{name:"User oauth"},{name:"Database"},{name:"Emails"}]},{isFeatured:!0,priceId:"price_456",name:"Advanced",description:"You need more power",price:99,priceAnchor:149,features:[{name:"NextJS boilerplate"},{name:"User oauth"},{name:"Database"},{name:"Emails"},{name:"1 year of updates"},{name:"24/7 support"}]}]},aws:{bucket:"bucket-name",bucketUrl:"https://bucket-name.s3.amazonaws.com/",cdn:"https://cdn-id.cloudfront.net/"},mailgun:{subdomain:"mg",fromNoReply:"ShipFast <noreply@mg.shipfa.st>",fromAdmin:"Marc at ShipFast <marc@mg.shipfa.st>",supportEmail:"marc@mg.shipfa.st",forwardRepliesTo:"marc.louvion@gmail.com"},colors:{theme:"valentine",main:t.n(s)().light.primary},auth:{loginUrl:"/api/auth/signin",callbackUrl:"/dashboard"}}},22361:(e,r,t)=>{t.d(r,{Z:()=>n});var s=t(11185),o=t.n(s);t(87786);let n=async()=>{if(!process.env.MONGODB_URI)throw Error("Add the MONGODB_URI environment variable inside .env.local to use mongoose");return o().connect(process.env.MONGODB_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}).catch(e=>console.error("Mongoose Client Error: "+e.message))}},74417:(e,r,t)=>{let s;t.d(r,{L:()=>l});var o=t(10375),n=t(31897),a=t(61906),i=t(35484),c=t(38013);let p=process.env.MONGODB_URI;p?s=new c.MongoClient(p,{}).connect():(console.group("⚠️ MONGODB_URI missing from .env"),console.error("It's not mandatory but a database is required for Magic Links."),console.error("If you don't need it, remove the code from /libs/next-auth.js (see connectMongo())"),console.groupEnd());let u=s,l={secret:process.env.NEXTAUTH_SECRET,providers:[(0,o.Z)({clientId:process.env.GOOGLE_ID,clientSecret:process.env.GOOGLE_SECRET,profile:async e=>({id:e.sub,name:e.given_name?e.given_name:e.name,email:e.email,image:e.picture,createdAt:new Date})}),...u?[(0,n.Z)({server:process.env.EMAIL_SERVER,from:i.Z.mailgun.fromNoReply})]:[]],...u&&{adapter:(0,a.dJ)(u)},callbacks:{session:async({session:e,token:r})=>(e?.user&&(e.user.id=r.sub),e)},session:{strategy:"jwt"},theme:{brandColor:i.Z.colors.main,logo:`https://${i.Z.domainName}/logoAndName.png`}}},24081:(e,r,t)=>{t.d(r,{Ze:()=>a,_R:()=>o,xL:()=>n});var s=t(43703);let o=async({priceId:e,mode:r,successUrl:t,cancelUrl:o,couponId:n,clientReferenceId:a,user:i})=>{let c=new s.Z(process.env.STRIPE_SECRET_KEY),p={};return i?.customerId?p.customer=i.customerId:("payment"===r&&(p.customer_creation="always",p.payment_intent_data={setup_future_usage:"on_session"}),i?.email&&(p.customer_email=i.email),p.tax_id_collection={enabled:!0}),(await c.checkout.sessions.create({mode:r,allow_promotion_codes:!0,client_reference_id:a,line_items:[{price:e,quantity:1}],discounts:n?[{coupon:n}]:[],success_url:t,cancel_url:o,...p})).url},n=async({customerId:e,returnUrl:r})=>{try{let t=new s.Z(process.env.STRIPE_SECRET_KEY);return(await t.billingPortal.sessions.create({customer:e,return_url:r})).url}catch(e){return console.error(e),null}},a=async e=>{try{let r=new s.Z(process.env.STRIPE_SECRET_KEY);return await r.checkout.sessions.retrieve(e,{expand:["line_items"]})}catch(e){return console.error(e),null}}},87786:(e,r,t)=>{t.d(r,{Z:()=>i});var s=t(11185),o=t.n(s),n=t(49976);let a=o().Schema({name:{type:String,trim:!0},email:{type:String,trim:!0,lowercase:!0,private:!0},image:{type:String},customerId:{type:String,validate:e=>e.includes("cus_")},priceId:{type:String,validate:e=>e.includes("price_")},hasAccess:{type:Boolean,default:!1}},{timestamps:!0,toJSON:{virtuals:!0}});a.plugin(n.Z);let i=o().models.User||o().model("User",a)},49976:(e,r,t)=>{t.d(r,{Z:()=>o});let s=(e,r,t)=>{if(t===r.length-1){delete e[r[t]];return}s(e[r[t]],r,t+1)},o=e=>{let r;e.options.toJSON&&e.options.toJSON.transform&&(r=e.options.toJSON.transform),e.options.toJSON=Object.assign(e.options.toJSON||{},{transform(t,o,n){if(Object.keys(e.paths).forEach(r=>{e.paths[r].options&&e.paths[r].options.private&&s(o,r.split("."),0)}),o._id&&(o.id=o._id.toString()),delete o._id,delete o.__v,r)return r(t,o,n)}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,791,3,225],()=>t(17666));module.exports=s})();